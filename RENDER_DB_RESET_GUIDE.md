# 🔧 Render データベース初期化手順

## 📅 作成日: 2026-02-15

---

## ❌ 問題点

在庫会計連携に必要な勘定科目が不足しています：
- **1300 商品**（資産）
- **5100 売上原価**（費用）
- **7100 雑収入**（収益）
- **8100 雑損失**（費用）

これらがないため、在庫登録時の仕訳が生成されません。

---

## ✅ 解決方法: Renderでデータベース初期化

### ステップ1: Render ダッシュボードを開く

1. https://render.com/dashboard を開く
2. **「menya-nishiki-api」** サービスをクリック

---

### ステップ2: 環境変数を一時的に変更

1. **「Environment」** タブをクリック
2. **「RESET_DB」** を探す
3. 現在の値: `false`
4. **「Edit」** をクリック
5. 値を **`true`** に変更
6. **「Save Changes」** をクリック

---

### ステップ3: 自動再デプロイを待つ

1. 環境変数を変更すると自動的に再デプロイが開始されます
2. **「Logs」** タブでログを確認
3. 以下のメッセージが表示されるまで待ちます（2-3分）：

```
Database initialized at...
Admin user: 麺家弍色
Server is running on port 5003
```

---

### ステップ4: 環境変数を元に戻す

⚠️ **重要**: データベース初期化後、必ず `RESET_DB=false` に戻してください！

1. **「Environment」** タブに戻る
2. **「RESET_DB」** を探す
3. **「Edit」** をクリック
4. 値を **`false`** に変更
5. **「Save Changes」** をクリック

---

### ステップ5: 動作確認

再デプロイ完了後、以下で確認：

```bash
curl https://menya-nishiki-api.onrender.com/api/health
```

結果:
```json
{"status":"ok","timestamp":"..."}
```

---

## 📝 初期化後の確認事項

### ✅ 勘定科目が作成される
- 1000 現金
- 1100 売掛金
- **1300 商品**（在庫用）
- 2000 買掛金
- 4000 売上高
- **5100 売上原価**（在庫出庫用）
- **7100 雑収入**（在庫調整用）
- **8100 雑損失**（在庫調整用）

### ✅ デフォルトユーザーが作成される
- ユーザー名: `麺家弍色`
- パスワード: `admin123`

### ✅ サンプルデータは削除される
- 仕訳帳: 空
- 在庫: 空
- 取引: 空

---

## 🧪 初期化後のテスト手順

### 1. ログイン
```
URL: https://menya-nishiki-system-cloud-79rourqw7-hozyopanda.vercel.app/
ユーザー名: 麺家弍色
パスワード: admin123
```

### 2. 在庫登録
- 商品名: ねぎ
- カテゴリ: 野菜
- 数量: 10
- 単価: 220

### 3. キャッシュフロー確認
- 会計帳簿 → キャッシュフロー計算書
- 期待: 営業支出 ¥2,200

### 4. 在庫出庫
- ねぎ → 出庫 → 3個

### 5. 損益計算書確認
- 会計帳簿 → 損益計算書
- 期待: 売上原価 ¥660

---

## ⚠️ 注意事項

1. **RESET_DB=true** はデータベースを完全に削除します
2. すべてのデータ（ユーザー以外）が失われます
3. 初期化後は必ず **RESET_DB=false** に戻してください
4. 本番運用後は絶対に **RESET_DB=true** にしないでください

---

**作成日**: 2026-02-15  
**対応必要**: Render でRESET_DB=true → 再デプロイ → RESET_DB=false
