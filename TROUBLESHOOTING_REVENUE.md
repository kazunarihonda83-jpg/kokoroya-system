# 損益計算書に売上が反映されない問題 - トラブルシューティングガイド

## 📊 現在の状況

### データベース確認結果
- ✅ 顧客データ: 2件登録済み
- ✅ 受注取引: 1件登録済み（OR-20260212-0001、¥10,450）
- ✅ 仕訳データ: 1件登録済み（売上高 ¥10,450）
- ✅ API: 正常に¥10,450を返却

**結論: バックエンドは正常に動作しています**

## 🔍 確認手順

### 1. ブラウザの開発者ツールで確認

1. **フロントエンドにアクセス**
   https://3013-iwz00ie3gdkhvxpx2ni1z-5c13a017.sandbox.novita.ai

2. **ログイン**
   - ユーザー名: `麺家弍色`
   - パスワード: `admin123`

3. **開発者ツールを開く**
   - Windows/Linux: `F12` または `Ctrl + Shift + I`
   - Mac: `Cmd + Option + I`

4. **コンソールタブを開く**

5. **損益計算書ページに移動**
   - 左メニュー → 会計帳簿 → 損益計算書

6. **コンソールログを確認**
   以下のログが表示されます：
   ```
   📊 損益計算書データ取得開始 {start_date: "2026-02-01", end_date: "2026-02-12"}
   ✅ 損益計算書レスポンス: {sales_revenue: 10450, ...}
   ```

### 2. 期間設定を確認

**重要:** 損益計算書の期間設定が、受注取引の日付を含んでいるか確認してください。

#### 現在の受注取引日付
- **受注日:** 2026-02-12

#### 期間設定の確認方法
1. 損益計算書画面の右上に「自」「至」の日付入力欄があります
2. デフォルト設定:
   - **自:** 当月1日（例: 2026-02-01）
   - **至:** 今日の日付（例: 2026-02-12）

#### 期間が正しくない場合
- 「自」を `2026-02-01` に設定
- 「至」を `2026-02-28` に設定
- これで2月の全データが表示されます

### 3. 新しい受注取引を登録してテスト

#### 手順
1. **顧客一覧を確認**
   - 左メニュー → 顧客管理 → 顧客一覧
   - 顧客が登録されていることを確認

2. **受注取引を登録**
   - 左メニュー → 受注取引管理 → 受注取引一覧
   - 「+ 新規登録」ボタンをクリック
   - 以下を入力:
     - **顧客:** 選択（例: テスト株式会社）
     - **受注日:** 今日の日付
     - **支払状況:** 支払済み
     - **商品1:**
       - 商品名: `ラーメン`
       - 数量: `5`
       - 単価: `800`
   - 「登録」ボタンをクリック

3. **登録成功を確認**
   - 「受注取引を登録しました」というアラートが表示される
   - 受注取引一覧に新しい受注が表示される

4. **損益計算書を確認**
   - 左メニュー → 会計帳簿 → 損益計算書
   - 期間を含む範囲に設定
   - **売上高** が増加していることを確認
   - 例: ¥10,450 → ¥14,850（新規 ¥4,400 追加）

### 4. キャッシュクリア

それでも表示されない場合、ブラウザキャッシュをクリアします：

#### ハードリフレッシュ
- **Windows/Linux:** `Ctrl + Shift + R` または `Ctrl + F5`
- **Mac:** `Cmd + Shift + R`

#### キャッシュ完全削除
1. ブラウザ設定を開く
2. プライバシーとセキュリティ
3. 閲覧データを削除
4. 以下をチェック:
   - ✅ キャッシュされた画像とファイル
   - ✅ Cookie とサイトデータ
5. 期間: すべて
6. データを削除

#### シークレットモードでテスト
- **Chrome/Edge:** `Ctrl + Shift + N`
- **Firefox:** `Ctrl + Shift + P`

シークレットモードで正常に表示される場合、ブラウザキャッシュの問題です。

## 🐛 よくある問題と解決策

### 問題1: 顧客が選択できない
**原因:** 顧客データが登録されていない  
**解決策:** 顧客管理 → 顧客一覧 → 新規登録で顧客を追加

### 問題2: 「データの読み込みに失敗しました」エラー
**原因:** ネットワークエラーまたはサーバーダウン  
**解決策:** 
- サーバーが起動しているか確認
- ネットワーク接続を確認
- ページをリロード

### 問題3: 売上高が0円のまま
**原因1:** 期間設定が誤っている  
**解決策:** 受注日を含む期間に設定

**原因2:** 受注取引の登録に失敗している  
**解決策:** 受注取引一覧で受注が表示されるか確認

**原因3:** ブラウザキャッシュ  
**解決策:** ハードリフレッシュまたはシークレットモード

### 問題4: 受注取引が登録できない
**原因:** 必須項目が未入力  
**解決策:** 以下を確認:
- ✅ 顧客が選択されている
- ✅ 受注日が入力されている
- ✅ 商品が1つ以上追加されている
- ✅ 各商品の数量と単価が入力されている

## 📞 サポート情報

### API動作確認

ターミナルで以下のコマンドを実行し、APIが正常かテスト:

```bash
# ログイン
TOKEN=$(curl -s -X POST http://localhost:5003/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"麺家弍色","password":"admin123"}' | jq -r '.token')

# 損益計算書API
curl -s -H "Authorization: Bearer $TOKEN" \
  "http://localhost:5003/api/accounting/profit-loss?start_date=2026-02-01&end_date=2026-02-28" \
  | jq
```

### デバッグログの確認

ブラウザのコンソールに以下のログが表示されます：

```
📊 損益計算書データ取得開始 {start_date: "...", end_date: "..."}
✅ 損益計算書レスポンス: {...}
```

レスポンスに `sales_revenue` の値が正しく含まれているか確認してください。

## 🎯 まとめ

1. ✅ **期間設定を確認** - 受注日を含む期間になっているか
2. ✅ **ブラウザキャッシュをクリア** - ハードリフレッシュを実行
3. ✅ **新規受注を登録してテスト** - 売上高が増加するか確認
4. ✅ **開発者ツールでログ確認** - APIレスポンスが正常か確認

これらの手順で問題が解決しない場合は、スクリーンショットと開発者ツールのログを共有してください。
