# 貸借対照表の表示に関するガイド

## 問題: 「全て売掛金に反映されている」「売掛金という項目しかない」

この問題は、以下のいずれかの原因で発生します：

### 1. ブラウザキャッシュの問題

**症状**: 
- 現金の項目が表示されない
- 支払済みの受注も売掛金に表示される

**解決方法**:
1. **ハードリフレッシュを実行**:
   - Windows/Linux: `Ctrl + Shift + R`
   - Mac: `Cmd + Shift + R`
2. **ブラウザキャッシュをクリア**:
   - Chrome: 設定 → プライバシーとセキュリティ → 閲覧履歴データの削除
   - キャッシュされた画像とファイルを削除

### 2. 日付フィルターの問題

**症状**:
- 基準日が古い日付になっている
- 新しく作成した受注取引が表示されない

**解決方法**:
1. 貸借対照表画面の右上にある日付を確認
2. 今日の日付または確認したい日付を設定
3. データが自動的に更新されます

### 3. データの確認方法

#### **受注取引の支払状況を確認**

1. 「受注取引一覧」を開く
2. 各受注の「支払状況」列を確認:
   - 🔴 **未払い** → 貸借対照表で「売掛金」に表示
   - 🟢 **支払済み** → 貸借対照表で「現金」に表示

#### **正しく表示されているか確認**

**未払い受注 ¥1,000を作成した場合**:
```
貸借対照表
├─ 資産の部
│  └─ 売掛金: ¥1,000
└─ 純資産の部
   └─ 当期純利益: ¥1,000
```

**支払済み受注 ¥1,000を作成した場合**:
```
貸借対照表
├─ 資産の部
│  └─ 現金: ¥1,000
└─ 純資産の部
   └─ 当期純利益: ¥1,000
```

**未払い ¥500 + 支払済み ¥1,000の場合**:
```
貸借対照表
├─ 資産の部
│  ├─ 現金: ¥1,000
│  └─ 売掛金: ¥500
│  └─ 資産合計: ¥1,500
└─ 純資産の部
   └─ 当期純利益: ¥1,500
```

## 会計処理の詳細

### 未払い受注取引の仕訳

```
受注作成時:
借方: 売掛金 ¥1,000
貸方: 売上高 ¥1,000

→ 貸借対照表: 売掛金 ¥1,000
```

### 支払済み受注取引の仕訳

```
受注作成時:
仕訳1: 借方: 売掛金 ¥1,000 / 貸方: 売上高 ¥1,000（売上計上）
仕訳2: 借方: 現金 ¥1,000 / 貸方: 売掛金 ¥1,000（即時回収）

→ 貸借対照表: 現金 ¥1,000（売掛金は相殺される）
```

### 未払い→支払済みへの変更

```
変更時:
追加仕訳: 借方: 現金 ¥1,000 / 貸方: 売掛金 ¥1,000

→ 貸借対照表: 売掛金が減少し、現金が増加
```

## トラブルシューティング

### ケース1: 支払済みなのに売掛金に表示される

**確認事項**:
1. 受注取引の詳細を開く
2. 「支払状況」が「支払済み」になっているか確認
3. 「支払日」が入力されているか確認

**対処法**:
- 支払日が入力されていない場合: 受注を編集して支払日を入力
- ブラウザをハードリフレッシュ（Ctrl+Shift+R / Cmd+Shift+R）

### ケース2: 現金の項目が表示されない

**確認事項**:
1. 支払済み受注が1件以上あるか確認
2. 基準日が正しいか確認（支払日以降の日付）

**対処法**:
- ブラウザをハードリフレッシュ
- 基準日を今日の日付に変更
- 開発者ツール（F12）→ Network タブでAPIレスポンスを確認

### ケース3: APIは正しいがUIに反映されない

**APIを確認**:
```bash
# APIエンドポイントに直接アクセス
curl -X GET "https://5003-...sandbox.novita.ai/api/accounting/balance-sheet?as_of_date=2026-02-12" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**レスポンス例（正常）**:
```json
{
  "assets": 1500,
  "assetAccounts": [
    {"name": "現金", "balance": 1000},
    {"name": "売掛金", "balance": 500}
  ]
}
```

**対処法**:
- APIレスポンスが正しい場合 → ブラウザキャッシュをクリア
- APIレスポンスが間違っている場合 → データベースを確認

## テスト環境での確認

**テスト環境URL**: https://3013-iwz00ie3gdkhvxpx2ni1z-5c13a017.sandbox.novita.ai
**ログイン情報**:
- ユーザー名: `麺家弍色`
- パスワード: `admin123`

**テスト手順**:
1. ログイン
2. 「受注取引一覧」で支払済み受注を作成
3. 「会計帳簿」→「貸借対照表」
4. 資産の部に「現金」と「売掛金」の両方が表示されることを確認

## サポート

問題が解決しない場合は、以下の情報を提供してください：

1. 受注取引の詳細（受注番号、支払状況、支払日、金額）
2. 貸借対照表の基準日
3. ブラウザの種類とバージョン
4. 開発者ツール（F12）→ Console タブのエラーメッセージ
5. Network タブの `/api/accounting/balance-sheet` のレスポンス
